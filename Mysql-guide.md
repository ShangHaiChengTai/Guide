# Mysql Guide

---	
## Mysql规范

---

## 文档目录
1. [背景](#1-背景)
1. [设计规范](#2-设计规范)
1. [操作规范](#3-操作规范)
1. [备注](#4-备注)

---
## 1 背景

现阶段的公司底层数据库以Mysql为主，希望通过以下规范，有效提升各应用的性能，同时为以后的维护铺平道路。持续更新中。

## 2 设计规范

### 2.1 命名规范

1. 数据库对象([备注1](#4-备注))使用小写字母，下划线和数字(经常不需要)的组合。

1. 数据库对象([备注1](#4-备注))长度不超过30字符。

1. 数据库对象([备注1](#4-备注))禁止使用Mysql关键字。

1. 数据库对象([备注1](#4-备注))命名尽量使用全名。当长度超过30字符时，可使用缩写来缩减长度。

1. 建议表的命名采用名词的复数形式。

1. 临时表以tmp_开头。

1. 备份的表，建议在名称后加上日期(tabel\_XXX_YYYYMMDD)。

### 2.2 数据库

1. 所有字符编码均采用UTF8编码，必要时采用UTF8MB4编码([备注2](#4-备注))。

### 2.3 数据表

1. 使用InnoDB存储引擎。

1. 多张表中相同的列，以及有JOIN需求的列，务必保持列名和数据类型的一致。

1. 表必须定义主键，默认为ID，整型自增或者UUID。

1. 单表一到两年内数据量超过500万或数据容量超过10G考虑分表，且需要提前考虑历史数据迁移或应用自行删除历史数据。

1. 单条数据大小禁止超过8K。

1. 不建议存储日志类型的数据。

### 2.4 表字段

1. 禁止使用外键。

1. 表被索引列必须定义为NOT NULL，并设有DEFAULT值。

1. 禁止使用FLOAT，DOUBLE类型，建议使用DECIMAL或者INT代替。

1. 禁止使用BLOB，TEXT类型存储大文本，文件以及图片。

1. 禁止将VARCHAR类型设计为主键。

1. 建议使用TINYINT类型来代替ENUM类型。

1. 建议使用UNSIGNED存储非负数值。

1. 建议使用INT UNSIGNED存储IPV4来节省存储空间，可以使用INET_ATON和INET_NTOA函数进行转换。

1. VARCHAR长度需要根据实际业务进行控制，禁止预留过长空间。

### 2.5 数据索引

1. 禁止重复索引。

1. 不在低基数列上建立索引，例如性别。 


## 3 操作规范

1. 为数据库访问账号设置复杂密码。

1. 开发测试以及相关业务操作，禁止使用数据库超级用户。禁止有超级权限的应用程序账号存在。

1. 禁止在数据库中存储明文密码。

1. 禁止使用非同类型的列进行等值查询。

1. 禁止使用跨库查询。

1. 禁止使用子查询，建议将子查询转换为关联查询。

1. 数据更新时建议先用二级查询先查询出主键，在根据主键进行数据更新。

1. 避免使用[SELECT *]，只取需要的字段来减少网络带宽消耗。

1. 用IN代替OR，IN包含的值不宜过多。

1. 使用UNION ALL代替UNION。

1. 避免负向%;

1. 对同一个表的多次ALTER操作必须合并为一次操作。

1. 避免使用存储过程，触发器，自定义函数，视图，事件等Mysql高级功能。

1. 禁止核心高并发业务流程QUERY内包含计算操作、多表关联、表遍历等复杂查询。建议拆分成简单查询。

1. 不要在Mysql数据库中存放业务逻辑。


## 4 备注

1. 数据库对象：database/table/column/index等。

1. 查看字符编码：show variables like 'character%';



